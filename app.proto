syntax = "proto3";

package kaist.iclab.abc;

option java_package = "kaist.iclab.abc.grpc";
option java_outer_classname = "AppProtos";
option java_multiple_files = true;

import "google/protobuf/empty.proto";
import "time.proto";

message App {
    enum Platform {
        UNKNOWN_PLATFORM = 0;
        MOBILE_ANDROID = 1;
        MOBILE_IOS = 2;
        MOBILE_FITBIT = 3;
        COMPUTER_WINDOWS = 4;
        COMPUTER_IOS = 5;
        COMPUTER_LINUX = 6;
        WEB = 7;
        OTHER = 8;
    }

    string uuid = 1;
    Platform platform = 2;
    string name = 3;
    string version = 4;
    int64 release_millis = 5;
    string url = 6;
    string changes = 7;

    message Collection {
        repeated App apps = 1;
        TimeRange release_millis = 2;
        int32 n_results = 3;
        bool has_remaining = 4;
    }

    message Query {
        message Select {
            App.Platform platform = 1;
            TimeRange release_millis = 2;
            int32 max_results = 3;
            bool is_descending_order = 4;
        }

        message One {
            string uuid = 1; 
        }
    }
}

service AppOperations {
    rpc ReadApps(App.Query.Select) returns (App.Collection) { }
    rpc ReadApp(App.Query.One) returns (App) { }
    rpc CreateApp(App) returns (App) { }
    rpc UpdateApp(App) returns (App) { }
    rpc DeleteApp(App.Query.One) returns (google.protobuf.Empty) { }
}